<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="STAT425, Fall 2023">
<meta name="dcterms.date" content="2023-12-15">

<title>STAT425 - Counting rules</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-H3YKZX4J88"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-H3YKZX4J88', { 'anonymize_ip': true});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">STAT425</span>
    </a>
  </div>
        <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Counting rules</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Course notes</div>
    <div class="quarto-title-meta-contents">
             <p>STAT425, Fall 2023 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Archived</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 15, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="finite-sample-spaces" class="level3">
<h3 class="anchored" data-anchor-id="finite-sample-spaces">Finite sample spaces</h3>
<p>Suppose <span class="math inline">\(S = \{s_1, \dots, s_n\}\)</span> and <span class="math inline">\(\mathcal{S} = 2^S\)</span>. Let <span class="math inline">\(\{p_i\}\)</span> be <span class="math inline">\(n\)</span> numbers such that <span class="math inline">\(0 \leq p_i \leq 1\)</span> and <span class="math inline">\(\sum_{i = 1}^n p_i = 1\)</span>. Then the set function</p>
<p><span class="math display">\[
P(E) = \sum_{i: x_i \in E} p_i \quad,\; E\in \mathcal{S}
\]</span></p>
<p>is a probability measure on <span class="math inline">\((S, \mathcal{S})\)</span>, <em>i.e.</em>, <span class="math inline">\((S, \mathcal{S}, P)\)</span> is a probability space.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since by construction <span class="math inline">\(\mathcal{S}\)</span> is a <span class="math inline">\(\sigma\)</span>-algebra, it remains only to check that <span class="math inline">\(P\)</span> satisfies the probability axioms.</p>
<ul>
<li>Axiom 1: <span class="math inline">\(P(E) = \sum_{i: x_i \in E} p_i \geq 0\)</span> since by hypothesis <span class="math inline">\(p_i \geq 0\)</span>.</li>
<li>Axiom 2: <span class="math inline">\(P(S) = \sum_{i: x_i \in S} p_i = \sum_{i = 1}^n p_i = 1\)</span>.</li>
<li>Axiom 3: let <span class="math inline">\(\{E_j\}\)</span> be disjoint and define <span class="math inline">\(I_j = \{i: x_i \in E_j\}\)</span>. Note that <span class="math inline">\(\left\{i: x_i \in \bigcup_j E_j\right\} = \bigcup_j I_j\)</span> and <span class="math inline">\(I_j \cap I_k = \emptyset\)</span> for <span class="math inline">\(j \neq k\)</span>. Then: <span class="math display">\[
P\left(\bigcup_j E_j\right) = \sum_{\bigcup_j I_j} p_i = \sum_j \sum_{I_j} p_i = \sum_j P(E_j)
\]</span></li>
</ul>
</div>
</div>
<p>So, probability measures on finite sample spaces are simply assignments of numbers in <span class="math inline">\([0, 1]\)</span> to each outcome that sum to one.</p>
<p>Now, if one has <span style="color:blue">equally likely outcomes</span> in a finite sample space, <em>i.e.</em>, <span class="math inline">\(p_i = p_j\)</span>, then: <span class="math display">\[
P(E) = \sum_{i: x_i \in E} p_i = \sum_{i: x_i \in E} \frac{1}{|S|} = \frac{|E|}{|S|}
\]</span></p>
<p>Thus, for finite probability spaces with equally likely outcomes, computing event probabilities is a matter of <span style="color:blue">counting</span>. While conceptually straightforward, it is often nontrivial to count the elements in a set. For example, how would you count the number of ways to draw a 3-of-a-kind in a 5-card poker hand? In other words, how many distinct combinations of 5 cards contain exactly three of matching rank and no other matches? For that matter, how many 5-card poker hands are possible? Once you know the answer, finding the probability of a 3-of-a-kind (or obtaining one by drawing 5 cards at random, anyway) is easy; counting the outcomes is the tricky part.</p>
</section>
<section id="counting-principles" class="level3">
<h3 class="anchored" data-anchor-id="counting-principles">Counting principles</h3>
<p><span style="color:blue">Multiplication rule (informally)</span>. In general, if a set of outcomes can be formed in <span class="math inline">\(k\)</span> steps and there are <span class="math inline">\(n_1, \dots, n_k\)</span> ways to complete each step, then there <span class="math inline">\(n_1 \times \cdots \times n_k\)</span> outcomes.</p>
<p>The intuition behind this principle is that for each of the <span class="math inline">\(n_1\)</span> ways of completing the first step, there are <span class="math inline">\(n_2\)</span> ways to complete the second step, and hence, <span class="math inline">\(n_1 \times n_2\)</span> total possibilities; then, for each of those possibilities, <span class="math inline">\(n_3\)</span> ways to complete the third step, so <span class="math inline">\(n_1 \times n_2 \times n_3\)</span> possibilities for completing the first three steps; and so on.</p>
<p>The term “step” is fairly loose, and need not correspond to a physical sequence of events. For example, one might represent that a playing card is specified in two steps by first selecting a suit, then a rank, even though, of course, one cannot physically choose a card in this way. “Steps” are just any systematic way of specifying outcome attributes; think of them like a recipe.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: choosing an outfit
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose you have a wardrobe of 30 tops, 20 bottoms, and 10 footwear options.</p>
<ol type="i">
<li>How many outfits can you make?</li>
<li>How many ways can you get dressed?</li>
<li>If you choose an outfit at random, what is the probability of selecting each outfit?</li>
<li>What about the probability of selecting an outfit with a specific top?</li>
</ol>
<p>These can all be answered informally.</p>
<ol type="i">
<li><p>For each of the 30 tops, you can pick any of 20 bottoms, and thus there are 600 distinct combinations of tops and bottoms; for each of those, there are 10 footwear options, making for 6000 total combinations. In other words, the number of outfits is <span class="math inline">\(30 \times 20 \times 10 = 6000\)</span>.</p></li>
<li><p>Think of this as choosing an outfit and then choosing an order in which to put it on. No matter which outfit is chosen, there are 6 ways to put it on — 3 options for the first garment to put on; 2 options for the second garment, and 1 option for the last garment. So for each of the 6000 outfits, there are 6 orders: thus, 12,000 ways to get dressed. (No wonder it’s so hard to make up one’s mind sometimes.)</p></li>
<li><p>If outfits are chosen at random, then every outfit is equally likely, so the probability that each outfit is selected is <span class="math inline">\(\frac{1}{6000} \approx 0.00017\)</span>.</p></li>
<li><p>The number of outfits including a specific top is the number of combinations of 1 top with 20 bottoms with 10 footwear options, so there are <span class="math inline">\(1 \times 20\times 10 = 200\)</span> such outfits; the probability of selecting one of these outfits at random is <span class="math inline">\(\frac{1}{30} \approx 0.033\)</span>. (Note that this is the same as the probability of selecting a given top at random.)</p></li>
</ol>
<p>Notice that in (i), the same garments specified in a different order are not regarded as a distinct outfit — that is, the outcomes of interest are <span style="color:blue">unordered</span>. By contrast, in (ii), when the sequence that items are put on is considered, the outcomes of interest are <span style="color:blue">ordered</span>.</p>
</div>
</div>
<p>The mathematical principle in use in the outfit example is that the cardinality of a Cartesian product is the product of the cardinalities. This is articulated formally below. Throughout, assume that the elements of a set are distinct, <em>i.e.</em>, that if we write <span class="math inline">\(A = \{a_1, \dots, a_n\}\)</span>, then <span class="math inline">\(a_i \neq a_j\)</span> for <span class="math inline">\(i \neq j\)</span>. (It would be highly unconventional to list the elements of a set in a way that includes duplicates, since, <em>e.g.</em>, <span class="math inline">\(\{0, 0, 1\} = \{0, 1\}\)</span> according to our definition of set identity.)</p>
<p><span style="color:blue">Multiplication Rule 1</span>. Let <span class="math inline">\(A = \{a_1, \dots, a_n\}\)</span> and <span class="math inline">\(B = \{b_1, \dots, b_m\}\)</span>. The number of possible pairs <span class="math inline">\((a, b)\)</span> that can be formed from the two sets is <span class="math inline">\(n \times m\)</span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof
</div>
</div>
<div class="callout-body-container callout-body">
<p>More formally, let <span class="math inline">\(|A| = n\)</span> and <span class="math inline">\(|B| = m\)</span>; the statement amounts to <span class="math inline">\(|A \times B| = |A| \times |B| = nm\)</span>. The elements of <span class="math inline">\(A\times B\)</span> can be arranged in an <span class="math inline">\(n \times m\)</span> array</p>
<p><span class="math display">\[
\begin{array}{ccccc}
(a_1, b_1) &amp;(a_1, b_2) &amp;\cdots &amp;(a_1, b_m) \\
(a_2, b_1) &amp;(a_2, b_2) &amp;\cdots &amp;(a_2, b_m) \\
\vdots &amp;\vdots &amp;\ddots &amp;\vdots \\
(a_n, b_1) &amp;(a_n, b_2) &amp;\cdots &amp;(a_n, b_m) \\
\end{array}
\]</span> showing that there are <span class="math inline">\(n \times m\)</span> distinct pairs.</p>
</div>
</div>
<p><span style="color:blue">Multiplication Rule 2</span>. Let <span class="math inline">\(A_1, \dots, A_m\)</span> be finite sets with <span class="math inline">\(|A_i| = n_i\)</span>. Then:</p>
<p><span class="math display">\[
|A_1 \times \cdots \times A_m| = |A_1| \times \cdots \times |A_m| = \prod_{i = 1}^m n_i
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof
</div>
</div>
<div class="callout-body-container callout-body">
<p>Apply multiplication rule 1 recursively. Define <span class="math inline">\(B_i = A_1 \times \cdots \times A_i\)</span>. Note that <span class="math inline">\(B_i = B_{i - 1} \times A_i\)</span>, so by multiplication rule 1, <span class="math inline">\(|B_i| = |B_{i - 1}|\times n_i\)</span>. Note also that <span class="math inline">\(|B_1| = |A_1| = n_1\)</span>. Then:</p>
<p><span class="math display">\[
\begin{align*}
|A_1 \times \cdots \times A_m|
&amp;= |B_{m - 1} \times A_m| \\
&amp;= |B_{m - 1}| \times n_m \\
&amp;= |B_{m - 2}| \times n_{m - 1} \times n_m \\
&amp;\;\;\vdots \\
&amp;= |B_1| \times n_2 \times \cdots \times n_m \\
&amp;= n_1 \times n_2 \times \cdots \times n_m \\
&amp;= \prod_{i = 1}^m n_i
\end{align*}
\]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check your understanding
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re buying nuts, apples, and cheese at the store and there are three kinds of nuts, four varieties of apples, and five cheeses, how many distinct purchases are possible if you only buy one kind of each item?</p>
<ol type="i">
<li>Reason out an answer using the informal multiplication rule.</li>
<li>Write the problem in terms of sets, and find the answer by multiplication rule 2.</li>
</ol>
</div>
</div>
</section>
<section id="combinations-permutations-and-more" class="level3">
<h3 class="anchored" data-anchor-id="combinations-permutations-and-more">Combinations, permutations, and more</h3>
<p>Often a counting problem (or a step in a counting problem) involves forming combinations of <span class="math inline">\(k\)</span> elements drawn from a finite set <span class="math inline">\(A = \{a_1, \dots, a_n\}\)</span> with <span class="math inline">\(|A| = n\)</span>. The number of combinations depends on how they are formed: by drawing with or without replacement, and by accounting for or ignoring the order in which elements were drawn. Formally, these methods correspond to finding the cardinalities the following sets:</p>
<ul>
<li>(ordered, with replacement) <span class="math inline">\(\{(a_{j_1}, \dots, a_{j_k}): j_i \in \{1, \dots, n\}\}\)</span></li>
<li>(ordered, without replacement) <span class="math inline">\(\{(a_{j_1}, \dots, a_{j_k}): j_i \in \{1, \dots, n\}; j_i \neq j_l \text{ for } i \neq l\}\)</span></li>
<li>(unordered, with replacement) <span class="math inline">\(\{[a_{j_1}, \dots, a_{j_k}]: j_i \in \{1, \dots, n\}\}\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>(unordered, without replacement) <span class="math inline">\(\{\{a_{j_1}, \dots, a_{j_k}\}: j_i \in \{1, \dots, n\}; j_i \neq j_l \text{ for } i \neq l\}\)</span></li>
</ul>
<p>In what follows, counting rules for each situation will be derived. The proofs rely in many instances on two facts: for disjoint sets <span class="math inline">\(A, B\)</span>, <span class="math inline">\(|A\cup B| = |A| + |B|\)</span>; and if <span class="math inline">\(A \subseteq B\)</span>, then <span class="math inline">\(|B\setminus A| = |B| - |A|\)</span>.</p>
<p><strong>Sampling with replacement 1 (SWR1): ordered and with replacement.</strong> Let <span class="math inline">\(A\)</span> be a set with <span class="math inline">\(|A| = n\)</span>. The number of <span style="color:blue">ordered</span> combinations of <span class="math inline">\(k\)</span> elements drawn <span style="color:blue">with replacement</span> from <span class="math inline">\(A\)</span> is <span class="math inline">\(n^k\)</span>.</p>
<p>Informally, apply the multiplication principle thinking of each draw as one ‘step’; since items are replaced after each draw, there are always <span class="math inline">\(n\)</span> options at every step, so the number of possibilities is <span class="math inline">\(n \times \cdots \times n = n^k\)</span>. A more formal proof follows.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof
</div>
</div>
<div class="callout-body-container callout-body">
<p>Enumerate the elements of <span class="math inline">\(A\)</span> as <span class="math inline">\(A = \{a_1, \dots, a_n\}\)</span>. The ordered combinations of <span class="math inline">\(k\)</span> elements of <span class="math inline">\(A\)</span> drawn with replacement are the distinct <span class="math inline">\(k\)</span>-tuples <span class="math inline">\((a_{j_1}, \dots, a_{j_k})\)</span> where <span class="math inline">\(j_i \in \{1, \dots, n\}\)</span> is some index. Note that possibly <span class="math inline">\(j_i = j_l\)</span> according to this schema. Now, <span class="math inline">\(\{(a_{j_1}, \dots, a_{j_k}): j_i \in \{1, \dots, n\}\} = A^k\)</span>, so using multiplication rule 2:</p>
<p><span class="math display">\[
|A^k| = |A \times \cdots \times A| = |A| \times \cdots \times |A| = |A|^k = n^k
\]</span></p>
</div>
</div>
<p><strong>Sampling without replacement 1 (SWOR1): ordered and without replacement</strong>. Let <span class="math inline">\(A\)</span> be a set with <span class="math inline">\(|A| = n\)</span>. The number of <span style="color:blue">ordered</span> combinations of <span class="math inline">\(k\)</span> distinct elements drawn <span style="color:blue">without replacement</span> from <span class="math inline">\(A\)</span> is:</p>
<p><span class="math display">\[
\frac{n!}{(n - k)!} = n \times (n - 1) \times \cdots \times (n - k + 1)
\]</span></p>
<p>Using the informal multiplication rule considering each draw as a step, this result is fairly obvious: for the first draw there are <span class="math inline">\(n\)</span> options, for the second, one option has been removed so there are <span class="math inline">\(n - 1\)</span>, for the third option, there are <span class="math inline">\(n - 2\)</span>, and so on, until the <span class="math inline">\(k\)</span>th draw, at which point there are <span class="math inline">\(n - k + 1\)</span> options. The proof below essentially formalizes this argument in terms of sets.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(B_k = \{(a_{j_1}, \dots, a_{j_k}): j_i \in \{1, \dots, n\}; j_i \neq j_l \text{ for } i \neq l\}\)</span>. The goal is to show that <span class="math inline">\(|B_k| = \frac{n!}{(n - k)!}\)</span> for arbitrary <span class="math inline">\(k\)</span>.</p>
<p>Enumerate the elements of <span class="math inline">\(B_k\)</span> as <span class="math inline">\(B_k = \{b_{k1}, b_{k2}, \dots, b_{kn_k}\}\)</span>. For each element, <span class="math inline">\(b_{ki} = (b_{ki1}, \dots, b_{kik}) = (a_{j_{1_i}}, \dots, a_{j_{k_i}})\)</span> for some collection of distinct indices <span class="math inline">\(j_{1_i}, \dots, j_{k_i}\)</span>. Note also that <span class="math inline">\(B_1 = A\)</span>. Now define:</p>
<p><span class="math display">\[
\begin{align*}
\tilde{b}_{ki} &amp;= \{b_{ki1}, \dots, b_{kik}\} \\
B_{ki} &amp;= \{b \in B_k: b_k \in A \setminus \tilde{b}_{k - 1, i}, (b_1, \dots, b_k - 1) = b_{k - 1, i}\} \\
\end{align*}
\]</span></p>
<p>In other words, <span class="math inline">\(\tilde{b}_{ki}\)</span> is the set of elements of <span class="math inline">\(A\)</span> included in the <span class="math inline">\(i\)</span>th ordered combination of <span class="math inline">\(k\)</span> elements; <span class="math inline">\(B_{ki}\)</span> is the set of ordered combinations of <span class="math inline">\(k\)</span> elements where the last element in the combination is not included in the <span class="math inline">\(i\)</span>th ordered combination of <span class="math inline">\(k - 1\)</span> elements. The indexing of ordered combinations is arbitrary.</p>
<p>Now, since <span class="math inline">\(b_{kij} \neq b_{kij'}\)</span> for <span class="math inline">\(j \neq j'\)</span>, <span class="math inline">\(|\tilde{b}_{ki}| = k\)</span>. Note also that <span class="math inline">\(|B_{ki}| = |A| - |\tilde{b}_{k-1, i}| = n - (k - 1)\)</span>, <span class="math inline">\(\{B_{ki}\}\)</span> is a mutually disjoint collection, and that <span class="math inline">\(B_k = \bigcup_i B_{ki}\)</span>. Then:</p>
<p><span class="math display">\[
|B_k|
= \left| \bigcup_{i = 1}^{|B_{k - 1}|} B_{ki} \right|
= \sum_{i = 1}^{|B_{k - 1}|} |B_{ki}|
= \sum_{i = 1}^{|B_{k - 1}|} \left[ n - (k - 1)\right]
= |B_{k - 1}| \left[ n - (k - 1)\right]
\]</span></p>
<p>So by recursion: <span class="math display">\[
\begin{align*}
|B_k| &amp;= |B_{k - 1}| \left[ n - (k - 1)\right] \\
&amp;= |B_{k - 2}| \left[ n - (k - 2)\right] \left[ n - (k - 1)\right] \\
&amp;\;\;\vdots \\
&amp;= |B_1| \left[n - 1\right] \cdots \left[ n - (k - 2)\right] \left[ n - (k - 1)\right] \\
&amp;= n (n - 1) \cdots (n - (k - 1))
\end{align*}
\]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: the birthday problem
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>In a group of</em> <span class="math inline">\(n &lt; 365\)</span> <em>unrelated people, what is the probability that two or more share a birthday?</em></p>
<p>Suppose the individuals are numbered <span class="math inline">\(1, \dots, n\)</span> and have birthdays <span class="math inline">\(b_1, \dots, b_n\)</span>. Represent the possible birthdays by the days of the year <span class="math inline">\(1, \dots, 365\)</span>. The sample space is the set of all possible collections of <span class="math inline">\(n\)</span> birthdays: <span class="math display">\[
S = \{(b_1, \dots, b_n): b_i \in \{1, \dots, 365\}\} = \{1, \dots, 365\}^n
\]</span></p>
<p>Assuming that birthdays are allocated uniformly at random, each outcome is equally likely. Since it’s much easier to count the number of ways that all birthdays are different, consider the complementary event: <span class="math display">\[
E = \{(b_1, \dots, b_n) \in S: b_i \neq b_j \text{ for } i \neq j\}
\]</span></p>
<p>Since <span class="math inline">\(S\)</span> is a set of ordered combinations of birthdays drawn with replacement, by SWR1 <span class="math inline">\(|S| = 365^n\)</span>. Since <span class="math inline">\(E\)</span> is a set of ordered combinations of birthdays drawn without replacement, by SWOR1 <span class="math inline">\(|E| = \frac{365!}{(365 - n)!}\)</span>. So: <span class="math display">\[
P(\text{at least two shared birthdays}) = 1 - P(E) = 1 - \frac{365!}{365^n (365 - n)!}
\]</span></p>
<p>A plot of the probabilities is shown below.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week2-counting_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><strong>Sampling without replacement 2 (SWOR2): unordered and without replacement</strong>. Let <span class="math inline">\(A\)</span> be a set with <span class="math inline">\(|A| = n\)</span>. The number of <span style="color:blue">unordered</span> combinations of <span class="math inline">\(k\)</span> distinct elements drawn <span style="color:blue">without replacement</span> from <span class="math inline">\(A\)</span> is:</p>
<p><span class="math display">\[
\frac{n!}{k! (n - k)!} = \frac{n\cdot (n - 1)\cdot \cdots \cdot (n - k + 1)}{k \cdot (k - 1) \cdot \cdots \cdot 2 \cdot 1}
\]</span></p>
<p>This result is also rather intuitive, given the SWOR1; for each unordered combination of elements drawn with replacement, by SWOR1 there are <span class="math inline">\(k!\)</span> possible ways to order the combination (form ordered combination of <span class="math inline">\(k\)</span> elements from <span class="math inline">\(k\)</span> options without replacement). One can then regard the number of ordered combinations as the result of choosing a combination and then choosing an order. So, by the multiplication rule, <span class="math inline">\((\#\text{ordered combinations}) = k! \times (\#\text{unordered combinations})\)</span>. The proof formalizes this argument.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(B_k\)</span> be the set of all <em>ordered</em> combinations of <span class="math inline">\(k\)</span> distinct elements drawn without replacement from <span class="math inline">\(A\)</span> (as in the proof of SWOR1) and consider: <span class="math display">\[
C_k = \{ \{a_{j_1}, \dots, a_{j_k}\} \subseteq A: j_i \neq j_{i'} \text{ for } i \neq i'\}
\quad\text{(all subsets of size $k$)}
\]</span></p>
<p>The goal is to show that <span class="math inline">\(|C_k| = \frac{n!}{k! (n - k)!}\)</span>. For each set <span class="math inline">\(C_{kj} \in C_k\)</span>, denote the set of ordered combinations formed from elements of <span class="math inline">\(C_{kj}\)</span> by <span class="math inline">\(B_{kj} = \{(a_{j_1}, \dots, a_{j_k}): a_{j_i} \in C_k\}\)</span>.</p>
<p>Note that by construction, <span class="math inline">\(\{B_{kj}\}\)</span> is a partition of <span class="math inline">\(B_k\)</span>. Further, <span class="math inline">\(|C_{kj} = k|\)</span>, so by SWOR1 we have that <span class="math inline">\(|B_{kj}| = \frac{k!}{(k - k)!} = k!\)</span>, and then:</p>
<p><span class="math display">\[
|B_k| = \left| \bigcup_{j = 1}^{|C_k|} B_{kj} \right| = \sum_{j = 1}^{|C_k|} |B_{kj}| = \sum_{j = 1}^{|C_k|} k! = |C_k| k!
\]</span></p>
<p>It follows that:</p>
<p><span class="math display">\[
|C_k| = \frac{|B_k|}{k!} = \frac{n!}{k! (n - k)!}
\]</span></p>
</div>
</div>
<p>The types of combinations resulting from sampling without replacement have special names: ordered combinations of distinct elements drawn without replacement are known as <span style="color:blue">permutations</span>; and unordered combinations are known as <span style="color:blue">combinations</span>. It is common to denote the corresponding counting rules with special notation:</p>
<ul>
<li>(permutations) <span class="math inline">\(P^n_k\)</span> or <span class="math inline">\(P_{n, k}\)</span> for <span class="math inline">\(\frac{n!}{(n - k)!}\)</span></li>
<li>(combinations) <span class="math inline">\(C^n_k\)</span> or <span class="math inline">\(C_{n, k}\)</span> for <span class="math inline">\(\frac{n!}{k! (n - k)!}\)</span></li>
</ul>
<p>These won’t be used in this class, but it’s useful to be aware of the notation, as many books use them. We will, however, adopt the notation <span class="math inline">\({n \choose k}\)</span> for unordered combinations of elements drawn with replacement; this is read “<span class="math inline">\(n\)</span> choose <span class="math inline">\(k\)</span>”, because the counting rule gives the number of ways to choose <span class="math inline">\(k\)</span> items from among <span class="math inline">\(n\)</span> possibilities.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: poker hands
</div>
</div>
<div class="callout-body-container callout-body">
<p>A typical poker hand is 5 playing cards drawn without replacement from a standard 52-card deck. The number of possible hands is the number of <em>unordered</em> combinations, because the same 5 cards drawn in any order yields the same hand. Thus the number of possible hands is:</p>
<p><span class="math display">\[
\#\text{hands} = {52\choose 5} = \frac{52!}{5!47!} = 2,598,960
\]</span></p>
<p>A 3-of-a-kind is a hand in which the rank of three cards matches, and the rank of the remaining two cards does not. How many distinct three-of-a-kind hands are there?</p>
<p>The hand can be obtained in the following “steps”: (i) choose a rank for the three matching cards; (ii) choose the suits of the three matching cards; (iii) choose the ranks of the non-matching pair; (iv) choose the suits of the non-matching pair. Each “choice” amounts to an unordered combination drawn without replacement, because the same card can’t be selected twice and selecting the same cards in any order produces to the same hand. The ways to accomplish each step are as follows:</p>
<ol type="i">
<li>Choose 1 rank from 13 possibilities (A, 2, 3, …, 10, J, Q, K)</li>
<li>Choose 3 suits from 4 possibilities (hears, spades, clubs, diamonds)</li>
<li>Choose 2 ranks from 12 possibilities (13 ranks less the rank selected for the matching pair)</li>
<li>Choose 1 suit from 4 possibilities</li>
<li>Choose 1 suit from 4 possibilities.</li>
</ol>
<p>Thus: <span class="math display">\[
\begin{align*}
\#\text{ 3-of-a-kind hands}
&amp;= {13\choose 1}\times {4\choose 3}\times {12\choose 2}\times {4\choose 1}\times {4\choose 1} \\
&amp;= 13\times 4 \times 66 \times 4 \times 4 \\
&amp;= 54912
\end{align*}
\]</span></p>
<p>If a hand is drawn at random, the probability of a 3-of-a-kind is <span class="math inline">\(\frac{54912}{{52 \choose 5}} = \frac{54912}{2598960} \approx 0.0211\)</span>.</p>
</div>
</div>
<p><strong>Sampling with replacement 2 (SWR2): unordered and with replacement.</strong> Let <span class="math inline">\(A\)</span> be a set with <span class="math inline">\(|A| = n\)</span>. The number of <span style="color:blue">unordered</span> combinations of <span class="math inline">\(k\)</span> (possibly nondistinct) elements drawn <span style="color:blue">with replacement</span> from <span class="math inline">\(A\)</span> is <span class="math inline">\({n + k - 1 \choose k}\)</span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proof
</div>
</div>
<div class="callout-body-container callout-body">
<p>The goal is to find <span class="math inline">\(|D_k|\)</span> where <span class="math inline">\(D_k = \{D_{kj} = [a_{j_1}, \dots, a_{j_k}]: j_i \in \{1, \dots, n\}\}\)</span>. Define:</p>
<p><span class="math display">\[
x_{ij} = \# \text{ of times } a_i \text{ is included in } D_{kj}
\]</span></p>
<p>Then <span class="math inline">\(\sum_{i = 1}^n x_{ij} = |D_{kj}| = k\)</span> by construction. Denote by <span class="math inline">\(x_j\)</span> the vector <span class="math inline">\((x_{1j}, x_{2j}, \dots, x_{nj})\)</span>. Note that <span class="math inline">\(D_{kj} = D_{kj'}\)</span> just in case <span class="math inline">\(x_j = x_{j'}\)</span>, and in fact there is a one-to-one correspondence between the elements of <span class="math inline">\(D_k\)</span> and the set <span class="math inline">\(V = \{x \in \{0, 1, \dots, k\}^n: \sum_{i = 1}^n x_i = k \}\)</span>. Thus, <span class="math inline">\(|D_k| = |V|\)</span>.</p>
<p>Consider the encoding of <span class="math inline">\(\sum_i x_{ij}\)</span> for an arbitrary <span class="math inline">\(x_j \in V\)</span> that results from expanding the sum and replacing integers by the corresponding number of vertical bars, for instance:</p>
<p><span class="math display">\[
\begin{align*}
\sum_{i = 1}^n x_{ij}
&amp;= 1 + 2 + 0 + 0 + 0 + 0 + 1 + \dots + 3 + 0 + 1 + 0 + 0 \\
&amp;= | + || + + + + | + \cdots + ||| + + | + +
\end{align*}
\]</span> Now, each unique <span class="math inline">\(x_j\)</span> will correspond to a distinct encoding sequence of <span class="math inline">\(|\)</span> and <span class="math inline">\(+\)</span>, and conversely each unique encoding sequence corresponds to exactly one <span class="math inline">\(x_j\)</span>. Further, there are precisely <span class="math inline">\(k\)</span> bars and <span class="math inline">\(n - 1\)</span> plus signs, so each encoding string comprises <span class="math inline">\(k + n - 1\)</span> characters. The unique encoding sequences result from the distinct allocations of bars to positions in the encoding string. In other words, there are exactly as many encoding sequences as there are ways to place the <span class="math inline">\(k\)</span> bars among the <span class="math inline">\(k + n - 1\)</span> positions. Thus:</p>
<p><span class="math display">\[
|D_k| = |V| = \text{\# of ways to allocate $k$ bars to $n + k - 1$ positions} = {n + k - 1 \choose k}
\]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: clown cars
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose 50 clowns are organizing a three-car caravan. They have a polka dot car, a striped car, and a swirl car. They are trying to decide how many clowns should go in each car. How many options are there?</p>
<p>Each arrangement is a grouping of the clowns into three groups — polka dot, stripes, swirls — so this can be thought of as sampling from the cars with replacement. The number of groupings is therefore: <span class="math display">\[
{3 + 50 - 1 \choose 50} = {52\choose 50} = \frac{52\cdot 51}{2} = 1326
\]</span> What about the number of configurations in which the polka dot car has at least 10 clowns? This can be done by assigning 10 clowns to the polka dot car and then allocating the remaining 40 clowns among the three cars, so the number of configurations is simply the number of ways to allocate 40 clowns to 3 cars: <span class="math display">\[
{3 + 40 - 1 \choose 40} = {42\choose 40} = \frac{42\cdot 41}{2} = 861
\]</span> What about the number of configurations in which the polka dot car has <em>exactly</em> 10 clowns? That amounts to allocating the remaining 40 clowns among only two cars: <span class="math display">\[
{2 + 40 - 1 \choose 40} = {41\choose 40} = 41
\]</span> Check your understanding:</p>
<ol type="1">
<li>What if each car must have at least one clown to drive and one to navigate?</li>
<li>What is the probability that all cars have at least 10 clowns?</li>
</ol>
</div>
</div>
<p>The table below summarizes the four counting rules.</p>
<table class="table">
<caption>Counting rules.</caption>
<colgroup>
<col style="width: 0%">
<col style="width: 12%">
<col style="width: 86%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Drawn with replacement</th>
<th>Drawn without replacement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Unordered</strong></td>
<td><span class="math display">\[                                                                                                                                                                                                                                      
                                                                                                                                                                                                            {n + k - 1 \choose k}                         
                                                                                                                                                                                                            \]</span></td>
<td><span class="math display">\[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {n \choose k}                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \]</span></td>
</tr>
<tr class="even">
<td><strong>Ordered</strong></td>
<td><span class="math display">\[                                                                                                                                                                                                                                      
                                                                                                                                                                                                            n^k                                           
                                                                                                                                                                                                            \]</span></td>
<td><span class="math display">\[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \frac{n!}{(n - k)!}                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \]</span></td>
</tr>
</tbody>
</table>
<p>The most commonly used rules are those pertaining to draws without replacement in the rightmost column, <em>i.e.</em>,combinations (top) and permutations (bottom).</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The notation <span class="math inline">\([x_1, \dots, x_n]\)</span> is an ad-hoc expression for the unordered collection consisting of <span class="math inline">\(x_1, \dots, x_n\)</span> possibly non-distinct elements. Some special notation is needed here because when the collection includes duplicates, it cannot be written as a set. For instance, <span class="math inline">\(\{0, 0, 1\} = \{0, 1\}\)</span> but <span class="math inline">\([0, 0, 1] \neq [0, 1]\)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2024 Trevor Ruiz</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>